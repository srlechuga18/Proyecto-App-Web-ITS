<!DOCTYPE html>
<html lang="en">

<head>
    <title>Admin: Docentes</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/global.css">
    <link href="../../css/simple-sidebar.css" rel="stylesheet">
    <link href="../../css/all.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../../DataTables/datatables.min.css" />
</head>

<body id="docentes">
    <div class="d-flex toggled" id="wrapper">
        <div class="bg-light border-right" id="sidebar-wrapper">
            <div class="sidebar-heading">
                <img src="" alt="" class="rounded-circle userfoto">
                <p id="username"></p>
            </div>

            <div class="list-group list-group-flush">
                <a href="/vistas/admin/horarios.html"
                    class="list-group-item list-group-item-action bg-light">Horarios</a>
                <a href="/vistas/admin/Salones.html" class="list-group-item list-group-item-action bg-light">Salones</a>
                <a href="#" class="list-group-item list-group-item-action bg-light active">Docentes</a>
                <a href="/vistas/admin/Grupos.html" class="list-group-item list-group-item-action bg-light">Grupos</a>
                <a href="/vistas/admin/Cursos.html" class="list-group-item list-group-item-action bg-light">Cursos</a>
            </div>
        </div>
        <div id="page-content-wrapper">
            <nav class="navbar">
                <!-- Brand -->
                <div>
                    <a class="navbar-brand" id="menu-toggle" href="#">
                        <i class="fas fa-bars"></i>
                    </a>
                    <span class="navbar-text">
                        Docentes
                    </span>
                </div>
                <a class="nav-link" id="log-out" href="#">
                    <i class="fas fa-sign-out-alt"></i>
                    Log Out
                </a>

            </nav>

            <div class="card text-center">
                <div class="card-header">
                    <ul class="nav nav-pills card-header-tabs" id="crud" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" href="#show" role="tab" aria-controls="show"
                                aria-selected="true">Horarios</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#add" role="tab" aria-controls="add"
                                aria-selected="false">Agregar</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#modify" role="tab" aria-controls="modify" aria-selected="false"
                                style="visibility: hidden;">Modificar</a>
                        </li>
                        <li class="nav-item">
                            <a id="delete" class="nav-link" href="#" style="visibility: hidden;">Borrar</a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content mt-3">
                        <div class="tab-pane active" id="show" role="tabpanel">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Foto</th>
                                        <th>Nombre</th>
                                        <th>Apellido Paterno</th>
                                        <th>Apellido Materno</th>
                                        <th>Correo</th>
                                        <th>Turno</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>

                        <div class="tab-pane" id="add" role="tabpanel" aria-labelledby="add-tab">
                            <p class="card-text">add</p>
                            <a href="#" class="card-link text-danger">Read add</a>
                        </div>

                        <div class="tab-pane" id="modify" role="tabpanel" aria-labelledby="modify-tab">
                            <p class="card-text">modify</p>
                            <a href="#" class="btn btn-danger btn-sm">Get modify</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../../jquery/jquery-3.4.1.min.js"></script>
    <script src="../../bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../DataTables/datatables.min.js"></script>

    <script>
        $(document).ready(function () {

            let base = window.location.origin;
            let id = localStorage.getItem("id");
            //trae datos del usuario actual
            $.ajax({
                url: base + "/api/usuarios/" + id,
                type: "GET",
                success: function (result) {
                    //pone foto y nombre del usuario
                    $(".userfoto").attr("src", "/api/public/img/" + result.foto);
                    $("#username").text(result.nombre + " " + result.apellidoPaterno + " " + result.apellidoMaterno);
                    
                    //trae todos los usuarios 
                    $.ajax({
                        url: base + "/api/usuarios",
                        type: "GET",
                        success: function (resulta2) {
                            //los pone en la tabla
                            resulta2.records.forEach(element => {
                                $('tbody').append(
                                    "<tr class='clickable-row' data-id=" + element.id + ">" +
                                    "<td style='padding: 1px'><img src='/api/public/img/" + element.foto + "' alt='' class='rounded-circle' height='45px' width='45px'></td>" +
                                    "<td>" + element.nombre + "</td>" +
                                    "<td>" + element.apellidoPaterno + "</td>" +
                                    "<td>" + element.apellidoMaterno + "</td>" +
                                    "<td>" + element.email + "</td>" +
                                    "<td>" + element.turno + "</td>" +
                                    "</tr>");
                            });
                            //les da formato
                            $('.table').DataTable();
                            //highlight de las columnas
                            $('.table').on('click', '.clickable-row', function (event) {
                                if ($(this).hasClass('bg-info')) {
                                    $(this).removeClass('bg-info');
                                    //esconde los botones de modificar y borrar
                                    $('.card-header ul').children('li').eq(2).children('a').css("visibility", "hidden");
                                    $('.card-header ul').children('li').eq(3).children('a').css("visibility", "hidden");
                                } else {
                                    $(this).addClass('bg-info').siblings().removeClass('bg-info');
                                    //muestra los botones de modificar y borrar
                                    $('.card-header ul').children('li').eq(2).children('a').css("visibility", "visible");
                                    $('.card-header ul').children('li').eq(3).children('a').css("visibility", "visible");

                                    //guarda el id del usuario seleccionado
                                    let id = $(this).data("id");

                                    //click en modificar
                                    $('.card-header ul').children('li').eq(2).children('a').off();
                                    $('.card-header ul').children('li').eq(2).children('a').click(function (e) {
                                        console.log(id);
                                        e.preventDefault()
                                        $(this).tab('show')
                                    });

                                    //click en borrar
                                    $('.card-header ul').children('li').eq(3).children('a').off();
                                    $('.card-header ul').children('li').eq(3).children('a').click(function (e) {
                                        console.log(id);
                                        e.preventDefault()
                                        $(this).tab('show')
                                    });
                                }
                            });

                        },
                        error: function (resp) {
                            alert("error al cargar usuarios");
                        }
                    });


                },
                error: function (resp) {
                    alert("inicie sesion");
                    window.location.href = "/";
                }
            });

        });

        //cambiar entre tabs 
        $('#crud a').click(function (e) {
            e.preventDefault()
            if($('.table .clickable-row').hasClass('bg-info')){
                $('.table .clickable-row').removeClass('bg-info');
            }            
            $('.card-header ul').children('li').eq(2).children('a').css("visibility", "hidden");
            $('.card-header ul').children('li').eq(3).children('a').css("visibility", "hidden");
            $(this).tab('show')
        });

        //side panel
        $("#menu-toggle").click(function (e) {
            e.preventDefault();
            $("#wrapper").toggleClass("toggled");
        });

        //log out
        $("#log-out").click(function (x) {
            localStorage.removeItem("id");
            window.location.href = "/";
        });
    </script>
</body>

</html>